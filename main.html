<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WeatherPro | Professional Weather Intelligence</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- GSAP -->
  <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>

  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --glass-bg: rgba(255, 255, 255, 0.15);
      --glass-border: rgba(255, 255, 255, 0.25);
    }

    body {
      transition: background 0.4s, color 0.4s;
    }

    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    canvas#three-bg {
      position: fixed;
      inset: 0;
      z-index: -1;
    }

    .loader {
      width: 48px;
      height: 48px;
      border: 5px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body class="bg-slate-900 text-white">

  <!-- Three.js Background -->
  <canvas id="three-bg"></canvas>

  <!-- Header -->
  <header class="container-fluid px-4 py-4 flex flex-wrap justify-between items-center glass sticky top-0 z-50">
    <div class="flex items-center gap-3">
      <h1 class="text-2xl font-bold">üå¶Ô∏è WeatherPro</h1>
      <span class="text-sm opacity-75">Professional Weather Intelligence</span>
    </div>

    <div class="flex flex-wrap gap-3 mt-3 sm:mt-0">
      <input id="cityInput" class="form-control" placeholder="Enter city" />
      <button id="searchBtn" class="btn btn-info">Search</button>
      <button id="themeToggle" class="btn btn-outline-light">üåô</button>
      <button id="downloadCSV" class="btn btn-outline-success">Export CSV</button>
      <button id="newsBtn" class="btn btn-outline-warning">Weather News</button>
    </div>
  </header>

  <!-- Main -->
  <main class="container my-5">

    <div id="loader" class="loader hidden"></div>

    <div class="row g-4" id="cards">
      <div class="col-md-3"><div class="glass rounded-4 p-4 text-center"><h6>Temperature</h6><p id="temp" class="text-3xl font-bold">-- ¬∞C</p></div></div>
      <div class="col-md-3"><div class="glass rounded-4 p-4 text-center"><h6>Humidity</h6><p id="humidity" class="text-3xl font-bold">-- %</p></div></div>
      <div class="col-md-3"><div class="glass rounded-4 p-4 text-center"><h6>Wind Speed</h6><p id="wind" class="text-3xl font-bold">-- km/h</p></div></div>
      <div class="col-md-3"><div class="glass rounded-4 p-4 text-center"><h6>Condition</h6><p id="condition" class="text-2xl font-semibold">--</p></div></div>
    </div>

    <div class="text-center mt-5 flex justify-center gap-4 flex-wrap">
      <button id="graphBtn" class="btn btn-primary">View Analytics</button>
      <button id="historyBtn" class="btn btn-secondary">History & Download</button>
    </div>

    <div class="mt-5 glass p-4 rounded-4">
      <canvas id="weatherChart"></canvas>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-center py-4 opacity-75">
    ¬© 2026 WeatherPro ¬∑ Designed for Professional Use
  </footer>

  <script>
    const API_KEY = "YOUR_API_KEY";
    let history = JSON.parse(localStorage.getItem("weatherHistory")) || [];

    const loader = document.getElementById("loader");

    async function fetchWeather(city) {
      loader.classList.remove("hidden");
      const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${API_KEY}`);
      const data = await res.json();
      loader.classList.add("hidden");

      const record = {
        temp: data.main.temp,
        humidity: data.main.humidity,
        wind: data.wind.speed,
        condition: data.weather[0].main,
        time: new Date().toLocaleString()
      };

      history.push(record);
      localStorage.setItem("weatherHistory", JSON.stringify(history));

      temp.innerText = record.temp + " ¬∞C";
      humidity.innerText = record.humidity + " %";
      wind.innerText = record.wind + " km/h";
      condition.innerText = record.condition;

      gsap.from(".glass", { opacity: 0, y: 30, stagger: 0.1 });
    }

    document.getElementById("searchBtn").onclick = () => {
      const city = document.getElementById("cityInput").value || "Delhi";
      fetchWeather(city);
    };

    document.getElementById("themeToggle").onclick = () => {
      document.body.classList.toggle("bg-white");
      document.body.classList.toggle("text-black");
    };

    document.getElementById("downloadCSV").onclick = () => {
      let csv = "Temp,Humidity,Wind,Condition,Time\n";
      history.forEach(h => csv += `${h.temp},${h.humidity},${h.wind},${h.condition},${h.time}\n`);
      const blob = new Blob([csv], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "weather_history.csv";
      a.click();
    };

    document.getElementById("graphBtn").onclick = () => {
      new Chart(document.getElementById("weatherChart"), {
        type: 'line',
        data: {
          labels: history.map(h => h.time),
          datasets: [
            { label: 'Temperature (¬∞C)', data: history.map(h => h.temp), tension: 0.4 },
            { label: 'Humidity (%)', data: history.map(h => h.humidity), tension: 0.4 }
          ]
        }
      });
    };

    document.getElementById("historyBtn").onclick = () => {
      alert(`Total Records Stored: ${history.length}`);
    };

    // Three.js background
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-bg'), alpha:true });
    renderer.setSize(window.innerWidth, window.innerHeight);

    const geometry = new THREE.IcosahedronGeometry(1.2, 1);
    const material = new THREE.MeshBasicMaterial({ wireframe: true });
    const mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);
    camera.position.z = 3;

    function animate() {
      requestAnimationFrame(animate);
      mesh.rotation.x += 0.002;
      mesh.rotation.y += 0.003;
      renderer.render(scene, camera);
    }
    animate();

    fetchWeather("Delhi");
  </script>
</body>
</html>